"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9819],{7384:(s,n,a)=>{a.r(n),a.d(n,{data:()=>e});const e={key:"v-4934f78b",path:"/serve/Linux/02-Chrony/",title:"Chrony（时间同步）",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"安装",slug:"安装",children:[]},{level:2,title:"配置",slug:"配置",children:[]},{level:2,title:"示例",slug:"示例",children:[{level:3,title:"设置 Chrony 服务器",slug:"设置-chrony-服务器",children:[]},{level:3,title:"查看时间同源状态",slug:"查看时间同源状态",children:[]}]},{level:2,title:"参考链接",slug:"参考链接",children:[]}],filePathRelative:"serve/Linux/02-Chrony/README.md",git:{updatedTime:1630372804e3,contributors:[{name:"Yue_plus",email:"Yue_plus@foxmail.com",commits:1}]}}},719:(s,n,a)=>{a.r(n),a.d(n,{default:()=>f});var e=a(6252);const r=(0,e._)("h1",{id:"chrony-时间同步",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#chrony-时间同步","aria-hidden":"true"},"#"),(0,e.Uk)(" Chrony（时间同步）")],-1),p={class:"custom-container tip"},o=(0,e._)("p",{class:"custom-container-title"},"TIP",-1),l=(0,e._)("p",null,"chrony 是网络时间协议（NTP）的通用实现。",-1),t={href:"https://chrony.tuxfamily.org/comparison.html",target:"_blank",rel:"noopener noreferrer"},c=(0,e.Uk)("与其他 NTP 实现比较"),i=(0,e._)("p",null,"chrony 包含两个程序：",-1),u=(0,e._)("ul",null,[(0,e._)("li",null,"chronyd 是一个可以在启动时启动的守护程序。"),(0,e._)("li",null,"chronyc 是一个命令行界面程序，用于监视 chronyd 的性能并在运行时更改各种操作参数。")],-1),b=(0,e.uE)('<h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> chrony\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h2><p>在 CentOS 中配置文件在 <code>/etc/chrony.conf</code>：</p><div class="language-conf ext-conf line-numbers-mode"><pre class="language-conf"><code># Use public servers from the pool.ntp.org project.\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\nserver 0.centos.pool.ntp.org iburst\nserver 1.centos.pool.ntp.org iburst\nserver 2.centos.pool.ntp.org iburst\nserver 3.centos.pool.ntp.org iburst\n\n# Record the rate at which the system clock gains/losses time.\ndriftfile /var/lib/chrony/drift\n\n# Allow the system clock to be stepped in the first three updates\n# if its offset is larger than 1 second.\nmakestep 1.0 3\n\n# Enable kernel synchronization of the real-time clock (RTC).\nrtcsync\n\n# Enable hardware timestamping on all interfaces that support it.\n#hwtimestamp *\n\n# Increase the minimum number of selectable sources required to adjust\n# the system clock.\n#minsources 2\n\n# Allow NTP client access from local network.\n#allow 192.168.0.0/16\n\n# Serve time even if not synchronized to a time source.\n#local stratum 10\n\n# Specify file containing keys for NTP authentication.\n#keyfile /etc/chrony.keys\n\n# Specify directory for log files.\nlogdir /var/log/chrony\n\n# Select which information is logged.\n#log measurements statistics tracking\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="示例" tabindex="-1"><a class="header-anchor" href="#示例" aria-hidden="true">#</a> 示例</h2><h3 id="设置-chrony-服务器" tabindex="-1"><a class="header-anchor" href="#设置-chrony-服务器" aria-hidden="true">#</a> 设置 Chrony 服务器</h3><p>修改 <code>/etc/chrony.conf</code> 文件：</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> server 0.centos.pool.ntp.org iburst\n</span><span class="token prefix deleted">-</span><span class="token line"> server 1.centos.pool.ntp.org iburst\n</span><span class="token prefix deleted">-</span><span class="token line"> server 2.centos.pool.ntp.org iburst\n</span><span class="token prefix deleted">-</span><span class="token line"> server 3.centos.pool.ntp.org iburst\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> server &lt;本机 IP / 域名&gt; iburst\n</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="查看时间同源状态" tabindex="-1"><a class="header-anchor" href="#查看时间同源状态" aria-hidden="true">#</a> 查看时间同源状态</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@host-10-20-70-107 ~<span class="token punctuation">]</span><span class="token comment"># chronyc sourcestats -v</span>\n<span class="token number">210</span> Number of sources <span class="token operator">=</span> <span class="token number">1</span>\n                             .- Number of sample points <span class="token keyword">in</span> measurement set.\n                            /    .- Number of residual runs with same sign.\n                           <span class="token operator">|</span>    /    .- Length of measurement <span class="token builtin class-name">set</span> <span class="token punctuation">(</span>time<span class="token punctuation">)</span>.\n                           <span class="token operator">|</span>   <span class="token operator">|</span>    /      .- Est. clock freq error <span class="token punctuation">(</span>ppm<span class="token punctuation">)</span>.\n                           <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>      /           .- Est. error <span class="token keyword">in</span> freq.\n                           <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>           /         .- Est. offset.\n                           <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>          <span class="token operator">|</span>          <span class="token operator">|</span>   On the -.\n                           <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>          <span class="token operator">|</span>          <span class="token operator">|</span>   samples. <span class="token punctuation">\\</span>\n                           <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>          <span class="token operator">|</span>          <span class="token operator">|</span>             <span class="token operator">|</span>\nName/IP Address            NP  NR  Span  Frequency  Freq Skew  Offset  Std Dev\n<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>\nhost-10-20-70-107.openst<span class="token operator">&gt;</span>   <span class="token number">0</span>   <span class="token number">0</span>     <span class="token number">0</span>     +0.000   <span class="token number">2000.000</span>     +0ns  4000ms\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="参考链接" tabindex="-1"><a class="header-anchor" href="#参考链接" aria-hidden="true">#</a> 参考链接</h2>',12),m={href:"https://www.cnblogs.com/jhxxb/p/11526098.html",target:"_blank",rel:"noopener noreferrer"},k=(0,e.Uk)("Linux 时间同步 Chrony - 江湖小小白 - 博客园"),d={href:"http://linux.vbird.org/linux_server/0440ntp.php",target:"_blank",rel:"noopener noreferrer"},h=(0,e.Uk)("第十五章、時間伺服器： NTP 伺服器 - 鳥哥的 Linux 私房菜"),f={render:function(s,n){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.iD)(e.HY,null,[r,(0,e._)("div",p,[o,l,(0,e._)("blockquote",null,[(0,e._)("p",null,[(0,e._)("a",t,[c,(0,e.Wm)(a)])])]),i,u]),b,(0,e._)("ul",null,[(0,e._)("li",null,[(0,e._)("a",m,[k,(0,e.Wm)(a)])]),(0,e._)("li",null,[(0,e._)("a",d,[h,(0,e.Wm)(a)])])])],64)}}}}]);